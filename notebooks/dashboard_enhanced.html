
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Avanzado - Predicci√≥n de Siniestros</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .main-header {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 30px;
            margin: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        .metric-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        .metric-card:hover {
            transform: translateY(-5px);
        }
        .chart-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .status-good { color: #28a745; }
        .status-warning { color: #ffc107; }
        .status-danger { color: #dc3545; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="main-header">
            <h1 class="text-center mb-4">üö¶ Dashboard de Predicci√≥n de Siniestros de Tr√°nsito</h1>
            <p class="text-center text-muted">Sistema ML para Prevenci√≥n de Accidentes - Per√∫</p>

            <div class="row mt-4">
                <div class="col-md-3">
                    <div class="metric-card">
                        <h5>Precisi√≥n del Modelo</h5>
                        <h2 id="accuracy" class="status-good">--</h2>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <h5>Regiones Analizadas</h5>
                        <h2 id="regions">--</h2>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <h5>Error Promedio</h5>
                        <h2 id="error">--</h2>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <h5>Predicciones 2024</h5>
                        <h2 id="future">--</h2>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="chart-card">
                    <h3>Comparaci√≥n Real vs Predicci√≥n</h3>
                    <div id="comparisonChart"></div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="chart-card">
                    <h3>Error por Regi√≥n</h3>
                    <div id="errorChart"></div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="chart-card">
                    <h3>Tendencia Temporal y Proyecciones</h3>
                    <div id="timelineChart"></div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="chart-card">
                    <h3>Tabla de Predicciones</h3>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Regi√≥n</th>
                                    <th>A√±o</th>
                                    <th>Valor Real</th>
                                    <th>Predicci√≥n</th>
                                    <th>Error (%)</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody id="predictionsTable">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    // Load data from JSON file or use sample data
    let dashboardData = null;

    // Try to load actual data
    $.getJSON("dashboard_data.json")
        .done(function(data) {
            dashboardData = data;
            initializeDashboard();
        })
        .fail(function() {
            // Use sample data if file not found
            console.log("Using sample data");
            dashboardData = {
                predictions: [
                    {region: "LIMA", year: 2022, actual: 41111, predicted: 38500, error_pct: 6.3},
                    {region: "LIMA", year: 2023, actual: 44995, predicted: 42000, error_pct: 6.7},
                    {region: "AREQUIPA", year: 2022, actual: 5017, predicted: 4800, error_pct: 4.3},
                    {region: "CUSCO", year: 2022, actual: 3365, predicted: 3200, error_pct: 4.9}
                ],
                future: [
                    {region: "LIMA", year: 2024, predicted_accidents: 46000},
                    {region: "LIMA", year: 2025, predicted_accidents: 47000}
                ],
                metrics: {
                    accuracy: 93.5,
                    mean_error: 6.5,
                    total_regions: 25
                }
            };
            initializeDashboard();
        });

    function initializeDashboard() {
        updateMetrics();
        createComparisonChart();
        createErrorChart();
        createTimelineChart();
        updateTable();
    }

    function updateMetrics() {
        $("#accuracy").text((dashboardData.metrics.accuracy || 93.5).toFixed(1) + "%");
        $("#regions").text(dashboardData.metrics.total_regions || 25);
        $("#error").text((dashboardData.metrics.mean_error || 6.5).toFixed(1) + "%");

        const total2024 = dashboardData.future
            .filter(d => d.year === 2024)
            .reduce((sum, d) => sum + (d.predicted_accidents || d.predicted || 0), 0);
        $("#future").text(total2024.toLocaleString());
    }

    function createComparisonChart() {
        const trace1 = {
            x: dashboardData.predictions.map(d => d.region),
            y: dashboardData.predictions.map(d => d.actual),
            name: "Valor Real",
            type: "bar"
        };

        const trace2 = {
            x: dashboardData.predictions.map(d => d.region),
            y: dashboardData.predictions.map(d => d.predicted),
            name: "Predicci√≥n",
            type: "bar"
        };

        const layout = {
            barmode: "group",
            xaxis: {title: "Regi√≥n"},
            yaxis: {title: "N√∫mero de Siniestros"}
        };

        Plotly.newPlot("comparisonChart", [trace1, trace2], layout);
    }

    function createErrorChart() {
        const trace = {
            x: dashboardData.predictions.map(d => d.region),
            y: dashboardData.predictions.map(d => d.error_pct),
            type: "bar",
            marker: {
                color: dashboardData.predictions.map(d => 
                    d.error_pct < 10 ? "green" : d.error_pct < 20 ? "orange" : "red"
                )
            }
        };

        const layout = {
            xaxis: {title: "Regi√≥n"},
            yaxis: {title: "Error (%)"}
        };

        Plotly.newPlot("errorChart", [trace], layout);
    }

    function createTimelineChart() {
        const regions = [...new Set(dashboardData.predictions.map(d => d.region))];
        const traces = [];

        regions.slice(0, 5).forEach(region => {
            const regionData = dashboardData.predictions.filter(d => d.region === region);
            const futureData = dashboardData.future.filter(d => d.region === region);

            traces.push({
                x: regionData.map(d => d.year),
                y: regionData.map(d => d.actual),
                name: region + " (Real)",
                type: "scatter",
                mode: "lines+markers"
            });

            traces.push({
                x: [...regionData.map(d => d.year), ...futureData.map(d => d.year)],
                y: [...regionData.map(d => d.predicted), ...futureData.map(d => d.predicted_accidents || d.predicted)],
                name: region + " (Predicci√≥n)",
                type: "scatter",
                mode: "lines+markers",
                line: {dash: "dot"}
            });
        });

        const layout = {
            xaxis: {title: "A√±o"},
            yaxis: {title: "N√∫mero de Siniestros"},
            hovermode: "x unified"
        };

        Plotly.newPlot("timelineChart", traces, layout);
    }

    function updateTable() {
        const tbody = $("#predictionsTable");
        tbody.empty();

        dashboardData.predictions.forEach(d => {
            const status = d.error_pct < 10 
                ? '<span class="status-good">‚úÖ Bueno</span>' 
                : d.error_pct < 20 
                ? '<span class="status-warning">‚ö†Ô∏è Regular</span>' 
                : '<span class="status-danger">‚ùå Revisar</span>';

            const row = `
                <tr>
                    <td>${d.region}</td>
                    <td>${d.year}</td>
                    <td>${(d.actual || 0).toLocaleString()}</td>
                    <td>${(d.predicted || 0).toLocaleString()}</td>
                    <td>${(d.error_pct || 0).toFixed(1)}%</td>
                    <td>${status}</td>
                </tr>
            `;
            tbody.append(row);
        });
    }
    </script>
</body>
</html>
